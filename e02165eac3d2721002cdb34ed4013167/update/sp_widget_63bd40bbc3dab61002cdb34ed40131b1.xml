<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function() {
  var c = this;

  c.action = function(state, id) {
    c.server.get({
      action: state,
      sys_id: id
    }).then(function(response) {
      c.data.approvals = response.data.approvals;
      alert("Request " + state + " successfully!");
    });
  };
};]]></client_script>
        <controller_as>c</controller_as>
        <css>.glass-container {
  background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%); /* Slightly darker for Admin */
  min-height: 100vh;
  padding: 40px 20px;
  color: white;
}

.glass-card {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 15px;
  padding: 25px;
  margin-bottom: 20px;
}

.req-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
}

.user-info {
  display: flex;
  gap: 20px;
  align-items: center;
}

.avatar-circle {
  width: 50px;
  height: 50px;
  background: #7c3aed;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 1.2rem;
}

.action-buttons {
  display: flex;
  gap: 10px;
}

.btn-approve {
  background: #10b981;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: bold;
  &amp;:hover { background: #059669; }
}

.btn-reject {
  background: #ef4444;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: bold;
  &amp;:hover { background: #dc2626; }
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>admin_approval</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Admin Approval</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
    data.approvals = [];
    var table = 'x_1862743_asset_re_asset_request_table';

    // 1. Handle the Approval/Rejection action from the client
    if (input && input.action) {
        var ar = new GlideRecord(table);
        if (ar.get(input.sys_id)) {
            ar.approval = input.action; // 'approved' or 'rejected'
            ar.state = (input.action == 'approved') ? '3' : '4'; // Closed Complete or Closed Incomplete
            ar.update();
        }
    }

    // 2. Fetch all pending requests
    var gr = new GlideRecord(table);
    gr.addQuery('approval', 'requested'); 
    gr.orderByDesc('sys_created_on');
    gr.query();

    while (gr.next()) {
        data.approvals.push({
            sys_id: gr.getUniqueValue(),
            number: gr.getDisplayValue('number'),
            asset: gr.request_asset.getDisplayValue(),
            user: gr.requested_for.getDisplayValue(),
            qty: gr.getValue('quantity'),
            total: gr.getDisplayValue('total_cost'),
            date: gr.getDisplayValue('sys_created_on')
        });
    }
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-01-14 05:59:40</sys_created_on>
        <sys_id>63bd40bbc3dab61002cdb34ed40131b1</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_name>Admin Approval</sys_name>
        <sys_package display_value="Asset Request and Tracking" source="x_1862743_asset_re">e02165eac3d2721002cdb34ed4013167</sys_package>
        <sys_policy/>
        <sys_scope display_value="Asset Request and Tracking">e02165eac3d2721002cdb34ed4013167</sys_scope>
        <sys_update_name>sp_widget_63bd40bbc3dab61002cdb34ed40131b1</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-01-14 06:00:34</sys_updated_on>
        <template><![CDATA[<div class="glass-container">
  <div class="container">
    
    <div class="header-section">
      <h1>Pending Approvals</h1>
      <p>Review and process incoming asset requests</p>
    </div>

    <div class="approval-grid">
      <div ng-if="data.approvals.length == 0" class="glass-card text-center">
        <h3>All caught up!</h3>
        <p>No pending approvals at this time.</p>
      </div>

      <div class="approval-item glass-card" ng-repeat="item in data.approvals">
        <div class="req-content">
          <div class="user-info">
            <div class="avatar-circle">{{item.user.charAt(0)}}</div>
            <div>
              <span class="req-number">{{item.number}}</span>
              <h3>{{item.user}} requested a {{item.asset}}</h3>
              <p>Quantity: {{item.qty}} | Total: {{item.total}}</p>
            </div>
          </div>
          
          <div class="action-buttons">
            <button class="btn-approve" ng-click="c.action('approved', item.sys_id)">
              <i class="fa fa-check"></i> Approve
            </button>
            <button class="btn-reject" ng-click="c.action('rejected', item.sys_id)">
              <i class="fa fa-times"></i> Reject
            </button>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>]]></template>
    </sp_widget>
</record_update>
